<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TinyRouter - Tu Librer√≠a de Routing Personalizada</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            min-height: 100vh;
            color: white;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .demo-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .nav-demo {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-link {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .nav-link.active {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            border-color: #e74c3c;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
        }

        .content-area {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 30px;
            min-height: 200px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .code-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            border-left: 4px solid #3498db;
        }

        .code-title {
            color: #3498db;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #2ecc71;
        }

        .feature-card h3 {
            color: #2ecc71;
            margin-bottom: 10px;
        }

        .download-section {
            text-align: center;
            background: rgba(46, 204, 113, 0.2);
            border: 2px solid rgba(46, 204, 113, 0.5);
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
        }

        .download-btn {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 18px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.4);
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(46, 204, 113, 0.6);
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            text-align: center;
        }

        .stat {
            padding: 10px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #3498db;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .nav-demo {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ TinyRouter</h1>
            <p>Tu librer√≠a de routing personalizada - Solo 2KB para cualquier proyecto</p>
        </div>

        <!-- Demo funcional -->
        <div class="demo-section">
            <h2>üéØ Demo en vivo:</h2>
            <div class="nav-demo">
                <a href="#/" class="nav-link" data-route="/">üè† Inicio</a>
                <a href="#/about" class="nav-link" data-route="/about">üë®‚Äçüíª Acerca de</a>
                <a href="#/projects" class="nav-link" data-route="/projects">üìÅ Proyectos</a>
                <a href="#/contact" class="nav-link" data-route="/contact">üìß Contacto</a>
                <a href="#/blog/123" class="nav-link" data-route="/blog/123">üìù Blog Post #123</a>
            </div>
            
            <div class="content-area" id="content">
                <!-- El contenido se carga aqu√≠ din√°micamente -->
            </div>
        </div>

        <!-- Documentaci√≥n de la librer√≠a -->
        <div class="demo-section">
            <h2>üìö Tu librer√≠a completa - TinyRouter.js</h2>
            
            <div class="code-section">
                <div class="code-title">üìÅ TinyRouter.js - Solo 2KB minificado</div>
<pre><code>/**
 * TinyRouter - Librer√≠a de routing ultra-ligera
 * Versi√≥n: 1.0.0 | Tama√±o: ~2KB | Sin dependencias
 * Funciona en file:// y http:// autom√°ticamente
 */

class TinyRouter {
    constructor(options = {}) {
        this.routes = new Map();
        this.middlewares = [];
        this.notFoundHandler = null;
        this.currentPath = '';
        this.params = {};
        this.query = {};
        
        // Configuraci√≥n
        this.config = {
            mode: 'auto', // 'auto', 'hash', 'history'
            hashPrefix: '#',
            debug: false,
            ...options
        };
        
        // Detectar modo autom√°ticamente
        if (this.config.mode === 'auto') {
            this.config.mode = location.protocol === 'file:' ? 'hash' : 'history';
        }
        
        this.init();
    }
    
    // Registrar ruta
    get(path, handler) {
        this.routes.set(path, handler);
        return this;
    }
    
    // Registrar middleware global
    use(middleware) {
        this.middlewares.push(middleware);
        return this;
    }
    
    // Manejar 404
    notFound(handler) {
        this.notFoundHandler = handler;
        return this;
    }
    
    // Navegar a ruta
    navigate(path, replace = false) {
        try {
            if (this.config.mode === 'hash') {
                if (replace) {
                    location.replace(this.config.hashPrefix + path);
                } else {
                    location.hash = path;
                }
            } else {
                if (replace) {
                    history.replaceState({}, '', path);
                } else {
                    history.pushState({}, '', path);
                }
                this.handleRoute();
            }
        } catch (error) {
            // Fallback a hash mode
            this.config.mode = 'hash';
            location.hash = path;
        }
    }
    
    // Obtener ruta actual
    getCurrentPath() {
        if (this.config.mode === 'hash') {
            return location.hash.slice(1) || '/';
        }
        return location.pathname;
    }
    
    // Parsear par√°metros de ruta
    parseRoute(pattern, path) {
        const patternParts = pattern.split('/').filter(Boolean);
        const pathParts = path.split('?')[0].split('/').filter(Boolean);
        
        if (patternParts.length !== pathParts.length) return null;
        
        const params = {};
        for (let i = 0; i < patternParts.length; i++) {
            const patternPart = patternParts[i];
            const pathPart = pathParts[i];
            
            if (patternPart.startsWith(':')) {
                params[patternPart.slice(1)] = decodeURIComponent(pathPart);
            } else if (patternPart !== pathPart) {
                return null;
            }
        }
        return params;
    }
    
    // Parsear query string
    parseQuery(path) {
        const queryIndex = path.indexOf('?');
        if (queryIndex === -1) return {};
        
        const query = {};
        const queryString = path.slice(queryIndex + 1);
        queryString.split('&').forEach(pair => {
            const [key, value] = pair.split('=');
            if (key) {
                query[decodeURIComponent(key)] = decodeURIComponent(value || '');
            }
        });
        return query;
    }
    
    // Ejecutar middlewares
    async runMiddlewares(context) {
        for (const middleware of this.middlewares) {
            await new Promise(resolve => {
                middleware(context, resolve);
            });
        }
    }
    
    // Manejar ruta actual
    async handleRoute() {
        const path = this.getCurrentPath();
        this.currentPath = path;
        this.query = this.parseQuery(path);
        
        // Crear contexto
        const context = {
            path,
            query: this.query,
            params: {},
            router: this
        };
        
        // Ejecutar middlewares
        await this.runMiddlewares(context);
        
        // Buscar ruta coincidente
        for (const [pattern, handler] of this.routes) {
            const params = this.parseRoute(pattern, path.split('?')[0]);
            if (params !== null) {
                context.params = params;
                this.params = params;
                
                if (this.config.debug) {
                    console.log(`TinyRouter: ${pattern} matched`, context);
                }
                
                return handler(context);
            }
        }
        
        // No encontrada
        if (this.notFoundHandler) {
            this.notFoundHandler(context);
        } else if (this.config.debug) {
            console.warn(`TinyRouter: No route found for ${path}`);
        }
    }
    
    // Inicializar router
    init() {
        // Event listeners
        if (this.config.mode === 'hash') {
            window.addEventListener('hashchange', () => this.handleRoute());
        } else {
            window.addEventListener('popstate', () => this.handleRoute());
        }
        
        // Procesar ruta inicial
        this.handleRoute();
        
        // Auto-vincular links con data-route
        this.bindLinks();
        
        if (this.config.debug) {
            console.log(`TinyRouter initialized in ${this.config.mode} mode`);
        }
    }
    
    // Vincular links autom√°ticamente
    bindLinks() {
        document.addEventListener('click', (e) => {
            const link = e.target.closest('[data-route]');
            if (link) {
                e.preventDefault();
                const route = link.getAttribute('data-route');
                this.navigate(route);
                this.updateActiveLinks(route);
            }
        });
    }
    
    // Actualizar links activos
    updateActiveLinks(currentRoute) {
        document.querySelectorAll('[data-route]').forEach(link => {
            const route = link.getAttribute('data-route');
            if (route === currentRoute) {
                link.classList.add('active');
            } else {
                link.classList.remove('active');
            }
        });
    }
}

// Versi√≥n global para usar en cualquier proyecto
window.TinyRouter = TinyRouter;</code></pre>
            </div>
        </div>

        <!-- Ejemplo de uso -->
        <div class="demo-section">
            <h2>üí° C√≥mo usar en tus proyectos</h2>
            
            <div class="code-section">
                <div class="code-title">üìÑ Uso b√°sico en cualquier HTML</div>
<pre><code>&lt;!-- 1. Incluir la librer√≠a --&gt;
&lt;script src="TinyRouter.js"&gt;&lt;/script&gt;

&lt;!-- 2. Navigation --&gt;
&lt;nav&gt;
    &lt;a href="#/" data-route="/"&gt;Inicio&lt;/a&gt;
    &lt;a href="#/about" data-route="/about"&gt;Acerca de&lt;/a&gt;
    &lt;a href="#/blog/123" data-route="/blog/123"&gt;Blog Post&lt;/a&gt;
&lt;/nav&gt;

&lt;div id="content"&gt;&lt;/div&gt;

&lt;script&gt;
// 3. Configurar router
const router = new TinyRouter({ debug: true });

// 4. Definir rutas
router
    .get('/', (ctx) =&gt; {
        document.getElementById('content').innerHTML = '&lt;h1&gt;üè† P√°gina Principal&lt;/h1&gt;';
    })
    .get('/about', (ctx) =&gt; {
        document.getElementById('content').innerHTML = '&lt;h1&gt;üë®‚Äçüíª Acerca de&lt;/h1&gt;';
    })
    .get('/blog/:id', (ctx) =&gt; {
        const { id } = ctx.params;
        document.getElementById('content').innerHTML = 
            `&lt;h1&gt;üìù Blog Post #${id}&lt;/h1&gt;`;
    })
    .notFound((ctx) =&gt; {
        document.getElementById('content').innerHTML = '&lt;h1&gt;‚ùå 404 - No encontrado&lt;/h1&gt;';
    });
&lt;/script&gt;</code></pre>
            </div>
        </div>

        <!-- Caracter√≠sticas -->
        <div class="demo-section">
            <h2>‚ú® Caracter√≠sticas</h2>
            
            <div class="stats">
                <div class="stat">
                    <div class="stat-number">2KB</div>
                    <div class="stat-label">Tama√±o minificado</div>
                </div>
                <div class="stat">
                    <div class="stat-number">0</div>
                    <div class="stat-label">Dependencias</div>
                </div>
                <div class="stat">
                    <div class="stat-number">100%</div>
                    <div class="stat-label">Compatible</div>
                </div>
            </div>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <h3>üéØ H√≠brido Inteligente</h3>
                    <p>Detecta autom√°ticamente file:// vs http:// y usa el modo de routing apropiado (hash vs history).</p>
                </div>
                
                <div class="feature-card">
                    <h3>üìä Par√°metros de Ruta</h3>
                    <p>Soporte completo para /blog/:id, /users/:name/posts/:postId con parsing autom√°tico.</p>
                </div>
                
                <div class="feature-card">
                    <h3>üîó Links Autom√°ticos</h3>
                    <p>Solo agrega data-route="/" y los links se vinculan autom√°ticamente con clase .active.</p>
                </div>
                
                <div class="feature-card">
                    <h3>üîç Query Strings</h3>
                    <p>Parsing autom√°tico de ?filtro=tech&categoria=web en ctx.query.</p>
                </div>
                
                <div class="feature-card">
                    <h3>üõ°Ô∏è Middleware Support</h3>
                    <p>Sistema de middleware para autenticaci√≥n, logging, etc.</p>
                </div>
                
                <div class="feature-card">
                    <h3>üöÄ Navegaci√≥n Program√°tica</h3>
                    <p>router.navigate('/ruta') con soporte para replace y history.</p>
                </div>
            </div>
        </div>

        <!-- Download -->
        <div class="download-section">
            <h2>üì¶ ¬°Descarga tu librer√≠a personalizada!</h2>
            <p>Copia el c√≥digo de TinyRouter.js y √∫salo en todos tus proyectos</p>
            <button class="download-btn" onclick="downloadLibrary()">‚¨áÔ∏è Descargar TinyRouter.js</button>
            <p style="margin-top: 15px; font-size: 14px; opacity: 0.8;">
                MIT License - √ösalo libremente en proyectos personales y comerciales
            </p>
        </div>
    </div>

    <script>
        // =====================================
        // TU LIBRER√çA TINYROUTER FUNCIONANDO
        // =====================================
        
        class TinyRouter {
            constructor(options = {}) {
                this.routes = new Map();
                this.middlewares = [];
                this.notFoundHandler = null;
                this.currentPath = '';
                this.params = {};
                this.query = {};
                
                this.config = {
                    mode: 'auto',
                    hashPrefix: '#',
                    debug: false,
                    ...options
                };
                
                if (this.config.mode === 'auto') {
                    this.config.mode = location.protocol === 'file:' ? 'hash' : 'history';
                }
                
                this.init();
            }
            
            get(path, handler) {
                this.routes.set(path, handler);
                return this;
            }
            
            use(middleware) {
                this.middlewares.push(middleware);
                return this;
            }
            
            notFound(handler) {
                this.notFoundHandler = handler;
                return this;
            }
            
            navigate(path, replace = false) {
                try {
                    if (this.config.mode === 'hash') {
                        if (replace) {
                            location.replace(this.config.hashPrefix + path);
                        } else {
                            location.hash = path;
                        }
                    } else {
                        if (replace) {
                            history.replaceState({}, '', path);
                        } else {
                            history.pushState({}, '', path);
                        }
                        this.handleRoute();
                    }
                } catch (error) {
                    this.config.mode = 'hash';
                    location.hash = path;
                }
            }
            
            getCurrentPath() {
                if (this.config.mode === 'hash') {
                    return location.hash.slice(1) || '/';
                }
                return location.pathname;
            }
            
            parseRoute(pattern, path) {
                const patternParts = pattern.split('/').filter(Boolean);
                const pathParts = path.split('?')[0].split('/').filter(Boolean);
                
                if (patternParts.length !== pathParts.length) return null;
                
                const params = {};
                for (let i = 0; i < patternParts.length; i++) {
                    const patternPart = patternParts[i];
                    const pathPart = pathParts[i];
                    
                    if (patternPart.startsWith(':')) {
                        params[patternPart.slice(1)] = decodeURIComponent(pathPart);
                    } else if (patternPart !== pathPart) {
                        return null;
                    }
                }
                return params;
            }
            
            parseQuery(path) {
                const queryIndex = path.indexOf('?');
                if (queryIndex === -1) return {};
                
                const query = {};
                const queryString = path.slice(queryIndex + 1);
                queryString.split('&').forEach(pair => {
                    const [key, value] = pair.split('=');
                    if (key) {
                        query[decodeURIComponent(key)] = decodeURIComponent(value || '');
                    }
                });
                return query;
            }
            
            async runMiddlewares(context) {
                for (const middleware of this.middlewares) {
                    await new Promise(resolve => {
                        middleware(context, resolve);
                    });
                }
            }
            
            async handleRoute() {
                const path = this.getCurrentPath();
                this.currentPath = path;
                this.query = this.parseQuery(path);
                
                const context = {
                    path,
                    query: this.query,
                    params: {},
                    router: this
                };
                
                await this.runMiddlewares(context);
                
                for (const [pattern, handler] of this.routes) {
                    const params = this.parseRoute(pattern, path.split('?')[0]);
                    if (params !== null) {
                        context.params = params;
                        this.params = params;
                        
                        if (this.config.debug) {
                            console.log(`TinyRouter: ${pattern} matched`, context);
                        }
                        
                        return handler(context);
                    }
                }
                
                if (this.notFoundHandler) {
                    this.notFoundHandler(context);
                } else if (this.config.debug) {
                    console.warn(`TinyRouter: No route found for ${path}`);
                }
            }
            
            init() {
                if (this.config.mode === 'hash') {
                    window.addEventListener('hashchange', () => this.handleRoute());
                } else {
                    window.addEventListener('popstate', () => this.handleRoute());
                }
                
                this.handleRoute();
                this.bindLinks();
                
                if (this.config.debug) {
                    console.log(`TinyRouter initialized in ${this.config.mode} mode`);
                }
            }
            
            bindLinks() {
                document.addEventListener('click', (e) => {
                    const link = e.target.closest('[data-route]');
                    if (link) {
                        e.preventDefault();
                        const route = link.getAttribute('data-route');
                        this.navigate(route);
                        this.updateActiveLinks(route);
                    }
                });
            }
            
            updateActiveLinks(currentRoute) {
                document.querySelectorAll('[data-route]').forEach(link => {
                    const route = link.getAttribute('data-route');
                    if (route === currentRoute) {
                        link.classList.add('active');
                    } else {
                        link.classList.remove('active');
                    }
                });
            }
        }

        // =====================================
        // DEMO DE LA LIBRER√çA FUNCIONANDO
        // =====================================
        
        // Crear router
        const router = new TinyRouter({ debug: true });

        // Middleware de ejemplo (opcional)
        router.use((ctx, next) => {
            console.log(`Navegando a: ${ctx.path}`);
            next();
        });

        // Definir rutas para el demo
        router
            .get('/', (ctx) => {
                document.getElementById('content').innerHTML = `
                    <h2>üè† P√°gina Principal</h2>
                    <p>¬°Bienvenido a TinyRouter! Tu librer√≠a de routing personalizada.</p>
                    <p><strong>Modo actual:</strong> ${ctx.router.config.mode}</p>
                    <p><strong>Ruta:</strong> ${ctx.path}</p>
                `;
            })
            .get('/about', (ctx) => {
                document.getElementById('content').innerHTML = `
                    <h2>üë®‚Äçüíª Acerca de TinyRouter</h2>
                    <p>TinyRouter es una librer√≠a de routing ultra-ligera de solo 2KB.</p>
                    <ul style="margin: 15px 0; padding-left: 20px;">
                        <li>‚úÖ Sin dependencias</li>
                        <li>‚úÖ Funciona en file:// y http://</li>
                        <li>‚úÖ Par√°metros de ruta</li>
                        <li>‚úÖ Query strings</li>
                        <li>‚úÖ Middleware support</li>
                    </ul>
                `;
            })
            .get('/projects', (ctx) => {
                document.getElementById('content').innerHTML = `
                    <h2>üìÅ Mis Proyectos</h2>
                    <p>Aqu√≠ puedes mostrar tu portfolio de proyectos.</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px;">
                            <h3>üöÄ Proyecto 1</h3>
                            <p>Descripci√≥n del proyecto...</p>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px;">
                            <h3>üéØ Proyecto 2</h3>
                            <p>Descripci√≥n del proyecto...</p>
                        </div>
                    </div>
                `;
            })
            .get('/contact', (ctx) => {
                document.getElementById('content').innerHTML = `
                    <h2>üìß Contacto</h2>
                    <p>¬øTienes alguna pregunta sobre TinyRouter?</p>
                    <form style="max-width: 400px; margin-top: 20px;">
                        <input type="text" placeholder="Tu nombre" style="width: 100%; padding: 10px; margin-bottom: 15px; border: none; border-radius: 5px;">
                        <input type="email" placeholder="Tu email" style="width: 100%; padding: 10px; margin-bottom: 15px; border: none; border-radius: 5px;">
                        <textarea placeholder="Tu mensaje" rows="4" style="width: 100%; padding: 10px; margin-bottom: 15px; border: none; border-radius: 5px; resize: vertical;"></textarea>
                        <button type="submit" style="background: #3498db; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer;">Enviar</button>
                    </form>
                `;
            })
            .get('/blog/:id', (ctx) => {
                const { id } = ctx.params;
                const query = ctx.query;
                
                document.getElementById('content').innerHTML = `
                    <h2>üìù Blog Post #${id}</h2>
                    <p><strong>ID del post:</strong> ${id}</p>
                    ${query.autor ? `<p><strong>Autor:</strong> ${query.autor}</p>` : ''}
                    ${query.categoria ? `<p><strong>Categor√≠a:</strong> ${query.categoria}</p>` : ''}
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px; margin-top: 20px;">
                        <h3>Contenido del post</h3>
                        <p>Este es el contenido del blog post #${id}. Aqu√≠ puedes cargar el contenido din√°micamente desde una API o base de datos.</p>
                    </div>
                    <p style="margin-top: 20px;">
                        <button onclick="router.navigate('/blog/456')" style="background: #e74c3c; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-right: 10px;">
                            Ir a Post #456
                        </button>
                        <button onclick="router.navigate('/blog/789?autor=Juan&categoria=Tech')" style="background: #9b59b6; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
                            Post #789 con Query
                        </button>
                    </p>
                `;
            })
            .notFound((ctx) => {
                document.getElementById('content').innerHTML = `
                    <h2>‚ùå 404 - P√°gina no encontrada</h2>
                    <p>La ruta <code>${ctx.path}</code> no existe.</p>
                    <button onclick="router.navigate('/')" style="background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 15px;">
                        Ir al inicio
                    </button>
                `;
            });

        // Funci√≥n para descargar la librer√≠a
        function downloadLibrary() {
            const libCode = `/**
 * TinyRouter - Librer√≠a de routing ultra-ligera
 * Versi√≥n: 1.0.0 | Tama√±o: ~2KB | Sin dependencias
 * Autor: Tu nombre aqu√≠
 */

class TinyRouter {
    constructor(options = {}) {
        this.routes = new Map();
        this.middlewares = [];
        this.notFoundHandler = null;
        this.currentPath = '';
        this.params = {};
        this.query = {};
        
        this.config = {
            mode: 'auto', // 'auto', 'hash', 'history'
            hashPrefix: '#',
            debug: false,
            ...options
        };
        
        if (this.config.mode === 'auto') {
            this.config.mode = location.protocol === 'file:' ? 'hash' : 'history';
        }
        
        this.init();
    }
    
    get(path, handler) {
        this.routes.set(path, handler);
        return this;
    }
    
    use(middleware) {
        this.middlewares.push(middleware);
        return this;
    }
    
    notFound(handler) {
        this.notFoundHandler = handler;
        return this;
    }
    
    navigate(path, replace = false) {
        try {
            if (this.config.mode === 'hash') {
                if (replace) {
                    location.replace(this.config.hashPrefix + path);
                } else {
                    location.hash = path;
                }
            } else {
                if (replace) {
                    history.replaceState({}, '', path);
                } else {
                    history.pushState({}, '', path);
                }
                this.handleRoute();
            }
        } catch (error) {
            this.config.mode = 'hash';
            location.hash = path;
        }
    }
    
    getCurrentPath() {
        if (this.config.mode === 'hash') {
            return location.hash.slice(1) || '/';
        }
        return location.pathname;
    }
    
    parseRoute(pattern, path) {
        const patternParts = pattern.split('/').filter(Boolean);
        const pathParts = path.split('?')[0].split('/').filter(Boolean);
        
        if (patternParts.length !== pathParts.length) return null;
        
        const params = {};
        for (let i = 0; i < patternParts.length; i++) {
            const patternPart = patternParts[i];
            const pathPart = pathParts[i];
            
            if (patternPart.startsWith(':')) {
                params[patternPart.slice(1)] = decodeURIComponent(pathPart);
            } else if (patternPart !== pathPart) {
                return null;
            }
        }
        return params;
    }
    
    parseQuery(path) {
        const queryIndex = path.indexOf('?');
        if (queryIndex === -1) return {};
        
        const query = {};
        const queryString = path.slice(queryIndex + 1);
        queryString.split('&').forEach(pair => {
            const [key, value] = pair.split('=');
            if (key) {
                query[decodeURIComponent(key)] = decodeURIComponent(value || '');
            }
        });
        return query;
    }
    
    async runMiddlewares(context) {
        for (const middleware of this.middlewares) {
            await new Promise(resolve => {
                middleware(context, resolve);
            });
        }
    }
    
    async handleRoute() {
        const path = this.getCurrentPath();
        this.currentPath = path;
        this.query = this.parseQuery(path);
        
        const context = {
            path,
            query: this.query,
            params: {},
            router: this
        };
        
        await this.runMiddlewares(context);
        
        for (const [pattern, handler] of this.routes) {
            const params = this.parseRoute(pattern, path.split('?')[0]);
            if (params !== null) {
                context.params = params;
                this.params = params;
                
                if (this.config.debug) {
                    console.log(\`TinyRouter: \${pattern} matched\`, context);
                }
                
                return handler(context);
            }
        }
        
        if (this.notFoundHandler) {
            this.notFoundHandler(context);
        } else if (this.config.debug) {
            console.warn(\`TinyRouter: No route found for \${path}\`);
        }
    }
    
    init() {
        if (this.config.mode === 'hash') {
            window.addEventListener('hashchange', () => this.handleRoute());
        } else {
            window.addEventListener('popstate', () => this.handleRoute());
        }
        
        this.handleRoute();
        this.bindLinks();
        
        if (this.config.debug) {
            console.log(\`TinyRouter initialized in \${this.config.mode} mode\`);
        }
    }
    
    bindLinks() {
        document.addEventListener('click', (e) => {
            const link = e.target.closest('[data-route]');
            if (link) {
                e.preventDefault();
                const route = link.getAttribute('data-route');
                this.navigate(route);
                this.updateActiveLinks(route);
            }
        });
    }
    
    updateActiveLinks(currentRoute) {
        document.querySelectorAll('[data-route]').forEach(link => {
            const route = link.getAttribute('data-route');
            if (route === currentRoute) {
                link.classList.add('active');
            } else {
                link.classList.remove('active');
            }
        });
    }
}

// Exportar para uso global
if (typeof module !== 'undefined' && module.exports) {
    module.exports = TinyRouter;
} else {
    window.TinyRouter = TinyRouter;
}`;

            const blob = new Blob([libCode], { type: 'application/javascript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'TinyRouter.js';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>